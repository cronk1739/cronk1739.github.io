<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Secret Slideshow</title>
    <style>
        html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#001233;color:#fff}
            .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:6px;box-sizing:border-box}
            .slideshow-container{position:relative;width:100%;max-width:1200px;padding:6px}
            .mySlides{display:none}
            /* make secret slideshow images large and reduce padding */
            .gallery-image{width:auto;min-height:65vh;max-height:calc(100vh - 60px);max-width:calc(100% - 12px);height:auto;object-fit:contain;border-radius:8px}
        .controls{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:8px}
        .prev,.next{cursor:pointer;padding:8px 12px;border-radius:6px;background:rgba(0,0,0,0.35);color:#fff}
        .dot{height:10px;width:10px;border-radius:50%;background:#777;display:inline-block;margin:0 6px}

        /* password overlay */
        #pw-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(rgba(0,0,0,0.6),rgba(0,0,0,0.8));z-index:9999}
    /* keep overlay darker but consistent with deep navy */
    #pw-box{background:#07112b;padding:14px;border-radius:8px;min-width:320px;color:#fff;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
        #pw-box input[type=password]{width:100%;padding:8px;margin-top:8px;border-radius:6px;border:1px solid #234}
        #pw-box button{margin-top:10px;padding:8px 10px;border-radius:6px;border:0;background:#ff4d94;color:#fff}
        #pw-hint{font-size:13px;color:#ddd;margin-top:6px}
    </style>
</head>
<body>
    <div class="wrap">
        <div class="slideshow-container" id="slideshow">
            <div class="gallery-wrapper">
                <div class="gallery-grid" id="secret-gallery">
                    <div class="thumb"><img data-src="assets/img_MineCraftStevedeath.JPG" src="assets/img_MineCraftStevedeath.JPG" alt="Secret 1"><div class="caption">Secret 1</div></div>
                    <div class="thumb"><img data-src="assets/img_RandomGuy.JPG" src="assets/img_RandomGuy.JPG" alt="Secret 2"><div class="caption">Secret 2</div></div>
                    <div class="thumb"><img data-src="assets/img_TheLioneatsthesmallchild.JPG" src="assets/img_TheLioneatsthesmallchild.JPG" alt="Secret 3"><div class="caption">Secret 3</div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="pw-overlay" role="dialog" aria-modal="true" aria-labelledby="pw-title">
        <div id="pw-box">
            <div id="pw-title" style="font-weight:700">Enter password to view</div>
            <input id="pw-input" type="password" placeholder="Password" aria-label="Secret password">
            <label style="display:flex;align-items:center;gap:8px;margin-top:8px"><input id="pw-show" type="checkbox"> Show password</label>
            <div style="display:flex;gap:8px;margin-top:8px"><button id="pw-submit">Unlock</button><button id="pw-cancel">Cancel</button></div>
            <div id="pw-hint">Hint: ask the admin for the secret password.</div>
        </div>
    </div>

    <script>
        // two-step client-side gate (session-only)
        // first password (checked by parent) is kept in the parent; the iframe requires a second password below
        const FIRST_PASS = 'M30W'; // first-stage password (checked by parent)
        const SECOND_PASS = 'ME0W :3'; // second-stage password required inside the iframe
        // Track progress inside this iframe
        let firstStageValidated = false;
        let unlockedInThisFrame = false;
        const overlay = document.getElementById('pw-overlay');
        const input = document.getElementById('pw-input');
        const submit = document.getElementById('pw-submit');
        const cancel = document.getElementById('pw-cancel');
        const showToggle = document.getElementById('pw-show');

        // helper to prevent background scroll while overlay visible
        function setBodyScrollDisabled(disabled){ try{ document.documentElement.style.overflow = disabled ? 'hidden' : ''; document.body.style.overflow = disabled ? 'hidden' : ''; }catch(e){} }

    function doFinalUnlock(v){ const val = String(v||''); if(val === SECOND_PASS){ unlockedInThisFrame = true; try{ overlay.style.display='none'; }catch(e){} setBodyScrollDisabled(false); try{ sessionStorage.setItem('secretUnlocked','1'); }catch(e){} initGallery(); try{ window.parent.postMessage({ type: 'secret-unlocked' }, location.origin); }catch(e){} return true; } return false; }

    function unlock(){ const v = input.value || ''; if(!firstStageValidated){ alert('Awaiting first password confirmation. Use the clock to submit the first password.'); input.value=''; input.focus(); return; } if(doFinalUnlock(v)){ return; } alert('Incorrect second password'); input.value=''; input.focus(); }

        submit.addEventListener('click', unlock);
        input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') unlock(); });
        cancel.addEventListener('click', ()=>{ try{ overlay.style.display='none'; setBodyScrollDisabled(false); }catch(e){} });
        if(showToggle){ showToggle.addEventListener('change', ()=>{ try{ input.type = showToggle.checked ? 'text' : 'password'; }catch(e){} }); }

        // listen for parent messages to attempt unlock via postMessage
    // Parent will post a 'try-unlock' message containing the first-stage password when the parent modal is used.
    // We should NOT auto-unlock on that message. Instead, validate the first-stage password and then require
    // the user to enter the SECOND_PASS inside this iframe.
    window.addEventListener('message', (ev)=>{
        try{
            if(!ev.data) return;
            // enforce same-origin postMessage to reduce risk (only accept messages from same origin)
            if(ev.origin !== location.origin) return;
            if(ev.data.type === 'try-unlock'){
                const pw = String(ev.data.password || '');
                if(pw === FIRST_PASS){
                    // first-stage validated by parent; now require second-stage in-iframe password
                    firstStageValidated = true;
                    try{
                        const title = document.getElementById('pw-title'); if(title) title.textContent = 'Enter second password';
                        const hint = document.getElementById('pw-hint'); if(hint) hint.textContent = 'Enter the second password to unlock.';
                        input.value = '';
                        input.focus();
                    }catch(e){}
                    // inform parent we received the first-stage (optional)
                    try{ window.parent.postMessage({ type: 'secret-first-validated' }, location.origin); }catch(e){}
                } else {
                    // if parent forwarded a wrong first password, notify parent
                    try{ window.parent.postMessage({ type: 'secret-unlock-failed' }, location.origin); }catch(e){}
                }
            }
        }catch(e){}
    });

        // always require an in-frame unlock; ensure overlay is visible and blocks scroll until unlocked
        try{ overlay.style.display='flex'; setBodyScrollDisabled(true); input.focus(); }catch(e){}

        // gallery + lightbox initialization for secret gallery (called after unlock)
        function initGallery(){
            const gallery = document.getElementById('secret-gallery');
            if(!gallery) return;
            const thumbs = Array.from(gallery.querySelectorAll('.thumb img'));
            // build a tiny lightbox overlay for secret page
            const overlay = document.createElement('div'); overlay.id = 'lightbox-overlay'; overlay.style.cssText = 'position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);z-index:9999';
            const img = document.createElement('img'); img.style.maxWidth='90%'; img.style.maxHeight='90%'; img.style.borderRadius='8px'; img.id='lb-img';
            const close = document.createElement('button'); close.textContent='âœ•'; close.style.cssText='position:fixed;top:18px;right:18px;z-index:10000;font-size:20px;padding:8px 10px';
            overlay.appendChild(img); document.body.appendChild(overlay); document.body.appendChild(close);
            thumbs.forEach((t,i)=> t.addEventListener('click', ()=>{ img.src = t.dataset.src||t.src; overlay.style.display='flex'; }));
            close.addEventListener('click', ()=>{ overlay.style.display='none'; img.src=''; });
            overlay.addEventListener('click',(e)=>{ if(e.target===overlay) { overlay.style.display='none'; img.src=''; } });
        }
    </script>
</body>
</html>